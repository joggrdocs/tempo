name: 'ci: PR Format'

on:
  pull_request:
    types: [opened, synchronize, reopened, labeled, unlabeled]

concurrency:
  group: ci-pr-format-${{ github.ref }}
  cancel-in-progress: true
  
jobs:
  format:
    runs-on: ubuntu-latest
    name: Formatting
    timeout-minutes: 5
    permissions:
      issues: write
      pull-requests: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          
      - name: Check for changeset files
        id: check-changeset
        run: |
          if [[ -n "$(git diff --name-only origin/main HEAD | grep -E '^\.changeset/')" ]]; then
            echo "has_changeset=true" >> $GITHUB_OUTPUT
          else
            echo "has_changeset=false" >> $GITHUB_OUTPUT
          fi
          
      - name: '🏷️ Validate Labels: Semver'
        if: steps.check-changeset.outputs.has_changeset != 'true'
        uses: mheap/github-action-required-labels@v5
        with:
          mode: exactly
          count: 1
          labels: "semver:.*"
          use_regex: true
      - name: '🏷️ Validate Labels: Type'
        if: steps.check-changeset.outputs.has_changeset != 'true'
        uses: mheap/github-action-required-labels@v5
        with:
          mode: exactly
          count: 1
          labels: "type:.*"
          use_regex: true
      - name: '🏷️ Validate Labels: Blocked'
        uses: mheap/github-action-required-labels@v5
        with:
          mode: exactly
          count: 0
          labels: "blocked"
          use_regex: true
