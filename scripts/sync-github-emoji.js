const fs = require('node:fs');
const path = require('node:path');
const axios = require('axios');

const URL =
  'https://raw.githubusercontent.com/ricealexander/emoji-list/main/emojis.json';

const FILE_NAME = 'emojis.ts';

const DIR_ROOT = path.join(__dirname, '..');

const FILE_PATH = path.join(DIR_ROOT, 'src', '@generated', FILE_NAME);

const warning = `
/* ðŸš¨ðŸš¨ðŸš¨ DO NOT EDIT ðŸš¨ðŸš¨ðŸš¨ */
/* This file is automatically generated. */
`;

axios
  .get(URL)
  .then((response) => {
    const data = response.data.map(({ alias, ...emoji }) => {
      if (Array.isArray(alias)) {
        return {
          ...emoji,
          aliases: alias,
        };
      }

      return {
        ...emoji,
        aliases: [alias],
      };
    });

    const content = `export default ${JSON.stringify(data, null, 2)} as const;`;
    fs.writeFileSync(FILE_PATH, [warning, content].join('\n\n').trimStart());

    console.log(
      `âœ… Synced ${data.length} emojis to "src/@generated/${FILE_NAME}"`
    );
  })
  .catch((error) => {
    console.error('Error fetching the JSON file:', error);
  });
